
import sys

McEliece22 = {'sec': 22, 'n': 94, 'k': 73, 't': 3, 'm': 7}
McEliece23 = {'sec': 23, 'n': 89, 'k': 61, 't': 4, 'm': 7}
McEliece24 = {'sec': 24, 'n': 102, 'k': 74, 't': 4, 'm': 7}
McEliece25 = {'sec': 25, 'n': 117, 'k': 89, 't': 4, 'm': 7}
McEliece26 = {'sec': 26, 'n': 115, 'k': 80, 't': 5, 'm': 7}
McEliece27 = {'sec': 27, 'n': 139, 'k': 99, 't': 5, 'm': 8}
McEliece28 = {'sec': 28, 'n': 142, 'k': 94, 't': 6, 'm': 8}
McEliece29 = {'sec': 29, 'n': 156, 'k': 108, 't': 6, 'm': 8}
McEliece30 = {'sec': 30, 'n': 172, 'k': 124, 't': 6, 'm': 8}
McEliece31 = {'sec': 31, 'n': 190, 'k': 142, 't': 6, 'm': 8}
McEliece32 = {'sec': 32, 'n': 191, 'k': 135, 't': 7, 'm': 8}
McEliece33 = {'sec': 33, 'n': 231, 'k': 183, 't': 6, 'm': 8}

McEliece34 = {'sec': 34, 'n': 404, 'k': 305, 't': 11, 'm': 9}
McEliece35 = {'sec': 35, 'n': 416, 'k': 308, 't': 12, 'm': 9}
McEliece36 = {'sec': 36, 'n': 414, 'k': 288, 't': 14, 'm': 9}
McEliece37 = {'sec': 37, 'n': 438, 'k': 312, 't': 14, 'm': 9}
McEliece38 = {'sec': 38, 'n': 464, 'k': 338, 't': 14, 'm': 9}
McEliece39 = {'sec': 39, 'n': 490, 'k': 364, 't': 14, 'm': 9}
McEliece40 = {'sec': 40, 'n': 500, 'k': 365, 't': 15, 'm': 9}
McEliece41 = {'sec': 41, 'n': 500, 'k': 347, 't': 17, 'm': 9}
McEliece42 = {'sec': 42, 'n': 510, 'k': 339, 't': 19, 'm': 9}
McEliece43 = {'sec': 43, 'n': 618, 'k': 458, 't': 16, 'm': 10}
McEliece44 = {'sec': 44, 'n': 648, 'k': 488, 't': 16, 'm': 10}
McEliece45 = {'sec': 45, 'n': 680, 'k': 520, 't': 16, 'm': 10}
McEliece46 = {'sec': 46, 'n': 712, 'k': 552, 't': 16, 'm': 10}
McEliece47 = {'sec': 47, 'n': 720, 'k': 550, 't': 17, 'm': 10}
McEliece48 = {'sec': 48, 'n': 752, 'k': 582, 't': 17, 'm': 10}
McEliece49 = {'sec': 49, 'n': 786, 'k': 616, 't': 17, 'm': 10}

<<<<<<< HEAD
McEliece50 = {'sec': 50, 'n': 750, 'k': 550, 't': 20, 'm': 10}
McEliece51 = {'sec': 51, 'n': 780, 'k': 580, 't': 20, 'm': 10}
McEliece52 = {'sec': 52, 'n': 808, 'k': 608, 't': 20, 'm': 10}
McEliece53 = {'sec': 53, 'n': 820, 'k': 610, 't': 21, 'm': 10}
McEliece54 = {'sec': 54, 'n': 832, 'k': 612, 't': 22, 'm': 10}
McEliece55 = {'sec': 55, 'n': 880, 'k': 670, 't': 21, 'm': 10}
McEliece56 = {'sec': 56, 'n': 870, 'k': 640, 't': 23, 'm': 10}
McEliece57 = {'sec': 57, 'n': 898, 'k': 668, 't': 23, 'm': 10}
McEliece58 = {'sec': 58, 'n': 928, 'k': 698, 't': 23, 'm': 10}
McEliece59 = {'sec': 59, 'n': 956, 'k': 726, 't': 23, 'm': 10}



McEliece60 = {'sec': 60, 'n': 988, 'k': 758, 't': 23, 'm': 10}
McEliece61 = {'sec': 61, 'n': 998, 'k': 758, 't': 24, 'm': 10}
McEliece62 = {'sec': 62, 'n': 1008, 'k': 758, 't': 25, 'm': 10}
McEliece63 = {'sec': 63, 'n': 1020, 'k': 760, 't': 26, 'm': 10}
McEliece64 = {'sec': 64, 'n': 1018, 'k': 738, 't': 28, 'm': 10}
McEliece65 = {'sec': 65, 'n': 1020, 'k': 720, 't': 30, 'm': 10}
McEliece66 = {'sec': 66, 'n': 1196, 'k': 899, 't': 27, 'm': 11}
McEliece67 = {'sec': 67, 'n': 1210, 'k': 902, 't': 28, 'm': 11}
McEliece68 = {'sec': 68, 'n': 1224, 'k': 905, 't': 29, 'm': 11}
McEliece69 = {'sec': 69, 'n': 1240, 'k': 910, 't': 30, 'm': 11}
=======
McEliece50 = {'sec': 50, 'n': 750, 'k': 550, 't': 20, 'm': 10} #0.733333333333333
McEliece51 = {'sec': 51, 'n': 780, 'k': 580, 't': 20, 'm': 10} #0.743589743589744
McEliece52 = {'sec': 52, 'n': 808, 'k': 608, 't': 20, 'm': 10} #0.752475247524752
McEliece53 = {'sec': 53, 'n': 820, 'k': 610, 't': 21, 'm': 10} #0.743902439024390
McEliece54 = {'sec': 54, 'n': 832, 'k': 612, 't': 22, 'm': 10} #0.735576923076923
McEliece55 = {'sec': 55, 'n': 880, 'k': 670, 't': 21, 'm': 10} #0.761363636363636
McEliece56 = {'sec': 56, 'n': 870, 'k': 640, 't': 23, 'm': 10} #0.735632183908046
McEliece57 = {'sec': 57, 'n': 898, 'k': 668, 't': 23, 'm': 10} #0.743875278396437
McEliece58 = {'sec': 58, 'n': 928, 'k': 698, 't': 23, 'm': 10} #0.752155172413793
McEliece59 = {'sec': 59, 'n': 956, 'k': 726, 't': 23, 'm': 10} #0.759414225941423

McEliece60 = {'sec': 60, 'n': 988, 'k': 758, 't': 23, 'm': 10} #0.767206477732793
McEliece61 = {'sec': 61, 'n': 998, 'k': 758, 't': 24, 'm': 10} #0.759519038076152
McEliece62 = {'sec': 62, 'n': 1008, 'k': 758, 't': 25, 'm': 10} #0.751984126984127
McEliece63 = {'sec': 63, 'n': 1020, 'k': 760, 't': 26, 'm': 10} #0.745098039215686
McEliece64 = {'sec': 64, 'n': 1018, 'k': 738, 't': 28, 'm': 10} #0.724950884086444
McEliece65 = {'sec': 65, 'n': 1020, 'k': 720, 't': 30, 'm': 10} #0.705882352941177
McEliece66 = {'sec': 66, 'n': 1196, 'k': 899, 't': 27, 'm': 11} #0.751672240802676
McEliece67 = {'sec': 67, 'n': 1210, 'k': 902, 't': 28, 'm': 11} #0.745454545454545
McEliece68 = {'sec': 68, 'n': 1224, 'k': 905, 't': 29, 'm': 11} #0.739379084967320
McEliece69 = {'sec': 69, 'n': 1240, 'k': 910, 't': 30, 'm': 11} #0.733870967741935
>>>>>>> 6017409a9e77d2cb1acce9a30b0005e8c0d23061

McEliece70 = {'sec': 70, 'n': 1322, 'k': 1014, 't': 28, 'm': 11}
McEliece71 = {'sec': 71, 'n': 1332, 'k': 1013, 't': 29, 'm': 11}
McEliece72 = {'sec': 72, 'n': 1343, 'k': 1013, 't': 30, 'm': 11}
McEliece73 = {'sec': 73, 'n': 1401, 'k': 1082, 't': 29, 'm': 11}
McEliece74 = {'sec': 74, 'n': 1388, 'k': 1047, 't': 31, 'm': 11}

<<<<<<< HEAD

McEliece75 = {'sec': 75, 'n': 1400, 'k': 1048, 't': 32, 'm': 11}
McEliece76 = {'sec': 76, 'n': 1434, 'k': 1082, 't': 32, 'm': 11}
McEliece77 = {'sec': 77, 'n': 1428, 'k': 1054, 't': 34, 'm': 11}
McEliece78 = {'sec': 78, 'n': 1460, 'k': 1086, 't': 34, 'm': 11}
McEliece79 = {'sec': 79, 'n': 1458, 'k': 1062, 't': 36, 'm': 11}
=======
McEliece75 = {'sec': 75, 'n': 1400, 'k': 1048, 't': 32, 'm': 11} #0.748571428571429
McEliece76 = {'sec': 76, 'n': 1434, 'k': 1082, 't': 32, 'm': 11} #0.754532775453278
McEliece77 = {'sec': 77, 'n': 1428, 'k': 1054, 't': 34, 'm': 11} #0.738095238095238
McEliece78 = {'sec': 78, 'n': 1460, 'k': 1086, 't': 34, 'm': 11} #0.743835616438356
McEliece79 = {'sec': 79, 'n': 1458, 'k': 1062, 't': 36, 'm': 11} #0.728395061728395
>>>>>>> 6017409a9e77d2cb1acce9a30b0005e8c0d23061

McEliece80 = {'sec': 80, 'n': 1488, 'k': 1092, 't': 36, 'm': 11}
McEliece81 = {'sec': 81, 'n': 1490, 'k': 1072, 't': 38, 'm': 11}
McEliece82 = {'sec': 82, 'n': 1506, 'k': 1077, 't': 39, 'm': 11}
McEliece83 = {'sec': 83, 'n': 1523, 'k': 1083, 't': 40, 'm': 11}
McEliece84 = {'sec': 84, 'n': 1540, 'k': 1089, 't': 41, 'm': 11}
McEliece85 = {'sec': 85, 'n': 1686, 'k': 1290, 't': 36, 'm': 11}
McEliece86 = {'sec': 86, 'n': 1749, 'k': 1364, 't': 35, 'm': 11}
McEliece87 = {'sec': 87, 'n': 1732, 'k': 1325, 't': 37, 'm': 11}
McEliece88 = {'sec': 88, 'n': 1745, 'k': 1327, 't': 38, 'm': 11}
McEliece89 = {'sec': 89, 'n': 1754, 'k': 1325, 't': 39, 'm': 11}
McEliece90 = {'sec': 90, 'n': 1788, 'k': 1359, 't': 39, 'm': 11} 

all_challenges = [McEliece22, McEliece23, McEliece24, McEliece25, McEliece26, McEliece27,
              McEliece28, McEliece29, McEliece30, McEliece31, McEliece32, McEliece33,
              McEliece34, McEliece35, McEliece36, McEliece37, McEliece38,
              McEliece39, McEliece40, McEliece41, McEliece42, McEliece43,
              McEliece44, McEliece45, McEliece46, McEliece47, McEliece48,
              McEliece49, McEliece50, McEliece51, McEliece52, McEliece53,
              McEliece54, McEliece55, McEliece56, McEliece57, McEliece58,
              McEliece59, McEliece60, McEliece61, McEliece62, McEliece63,
              McEliece64, McEliece65, McEliece66, McEliece67, McEliece68,
              McEliece69,
              McEliece70, McEliece71, McEliece72, McEliece73, McEliece74,
              McEliece75, McEliece76, McEliece77, McEliece78, McEliece79,
              McEliece80, McEliece81, McEliece82, McEliece83, McEliece84, McEliece85,
              McEliece86, McEliece87, McEliece88, McEliece89, McEliece90]

def find_correct_instance(sec):
    for instance in all_challenges:
        if instance['sec']==sec: return instance
    raise ValueError("instance with n = ", n, 'is not found')

def read_H_s_from_file(path, filename, n, k):
    H = matrix(GF(2), n-k, n)
    s = vector(GF(2), n-k)
    i = 0
    with open(path+filename, 'r') as f:
        for line in f:
            if i<n-k:
                line = line.strip('[').strip(']\n')
                H[i] = vector([GF(2)(el) for el in line.split(' ')])
            elif i==n-k:
                line = line.strip('(').strip(')\n')
                s = vector([GF(2)(el) for el in line.split(', ')])
            else: break
            i+=1

    return H, s



def check_error(e_str, sec):
    e = vector([GF(2)(e_str[i]) for i in range(len(e_str)) ])


    instance = find_correct_instance(sec)
    n = instance['n']
    k = instance['k']
    t = instance['t']

    if not len(e) == n:
        print('Wrong error length')
        return 0

    if not sum([int(e[i]) for i in range(n)])==t:
        print('Wrong error weight:')
        return 0

    path_pub = "public/"
    filename_pub = 'pk_McEliece_'+str(instance['sec'])+'.txt'

    H, s = read_H_s_from_file(path_pub, filename_pub, n, k)

    if not H*e == s:
        print('H*e==s is not satisfied')
        return 0

    return 1

if __name__ == '__main__':
    """
        Run  sage check_solution_track3.sage bit_sec e
        Example: 22 0000000000000000000000000000000010000010000000000000000000000000000000000000000000000100000000
        Requires existence of the public data in public/pk_McEliece_*sec*.txt
    """

    print(check_error(sys.argv[2], int(sys.argv[1])))
